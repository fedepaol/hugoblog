---
layout: post
redirect_from:
  - /blog/6707001740082933324/
title: "Intellij, Robolectric and Android"
date: 2012-07-23
comments: false
categories:
 - intellij
 - Android
 - robolectric
 - maven
---

<div class='post'>
<br /><br />I have been curious about intellij since droicon uk 2011, where I noticed that some of the speakers were using IntelliJ instead of eclipse.<br /><br />A <a href="https://plus.google.com/115995639636688350464/posts/CgPZkFGvbm3">post</a> from Richard Hyndman, who is a developer advocate from Google, was the final straw that pushed me to download IntelliJ and give it a try.<br /><br />The first thing an eclipse user will notice in intellij is how slick and fast compares to the behemoth which is eclipse. On the other hand, an you can feel a bit disoriented at first.<br /><br /><br />Setting up a new android project using IntelliJ is pretty straightforward. You can follow the nice tutorial from jetbrains website http://wiki.jetbrains.net/intellij/Android.<br />For this reason, I will not write about how to set up an Android project in intellij here.<br /><br /><br />What I am going to write about is how to setup an <b>android project with intellij and integrate robolectric</b> with it.<br /><br />I really like robolectric. It makes unit testing for android a lot faster as it would be on the emulator. What's more, you can use mockito with it.<br />Mockito is a mocking framework that makes a lot easier to mock your java objects.<br />Mockito does not work with dalvik jvm, but robolectric makes your tests run on your pc's jvm.<br /><br /><br />Despite robolectric provides instruction on how to setup an intellij project manually, I have tried that process a lot of times, carefully checking if I was missing a step.<br />However, I did not manage to get it working. The guys from Pivotal provide also an intellij starter project, which you can configure to point a git repository https://github.com/pivotal/AndroidIntelliJStarter<br /><br /><br />However, I was not either satisfied with this solution and, inspired by this <a href="https://groups.google.com/forum/?fromgroups#!topic/robolectric/QN6dskFjrHc">post</a>&nbsp;,&nbsp;I tried to setup a maven solution and to import it in intellij afterwards.<br /><br />This provides another great benefit, which is the fact that I can import the same project in my linux netbook without bothering for relative paths in eclipse projects.<br /><br />So, here are the steps I had to follow in order to get it working:<br /><br />- Install the android sdk. This is trivial, I assume you are comfortable with that<br />- Let the ANDROID_HOME environment variable point the path where you uncompressed the android sdk<br />- You need to have at least one version of the sdk installed, so if you haven't yet, you should launch the sdk manager that is the "android" executable on ANDROID_HOME/tools/android. Install also the extras, such as the compatibility library, admob stuff and all the libraries you find at the bottom<br /><br /><br />- install the maven android sdk deployer you can find at <a href="https://github.com/mosabua/maven-android-sdk-deployer">https://github.com/mosabua/maven-android-sdk-deployer </a>and then install it.<br /><br />I read somewhere that you can get android jar without relying on it, but in any case, if you need google maps or other private apis like that you still need to use this tool.<br />&nbsp;I use the latest (almost) version which is 4.0.3, so I run mvn install -P 4.0.3<br /><br /><br />- Install maven android plugin. The easiest way is to use android archetypes from here:<br />https://github.com/akquinet/android-archetypes<br /><br /><br />Finally, you are now ready to generate your first maven android project:<br /><br /><br /><br /><br /><br />mvn archetype:generate \<br />&nbsp; -DarchetypeArtifactId=android-quickstart \<br />&nbsp; -DarchetypeGroupId=de.akquinet.android.archetypes \<br />&nbsp; -DarchetypeVersion=1.0.8 \<br />&nbsp; -DgroupId=your.company \<br />&nbsp; -DartifactId=my-android-application<br /><br /><br /><br />You <i>could</i> find an issue. &nbsp;Recently the tree of the android sdk folders has been slightly changed. Maven android plugin expects them to be in the updated version (I don't remember what the differences where). However, if maven complains it cannot find android related stuff, and your sdk has been installed for some time, a good option would be to remove the sdk and reinstall it from scratch (at least the part you download with the sdk manager).<br /><br /><br /><br />At this point, you have a working maven project, which you could already open with intellij. What is still missing is the robolectric dependencies.<br />Nothing more easy, all you have to do is to add<br /><br /><br /><br /><br /><script src="https://gist.github.com/3165830.js?file=aaa.xml"></script> right below android dependencies.  You should also create the test folder, under <i>src/test/your/package/ </i><br /><br />Now, a problem I had was that I had to change the pointer of the repository in order to have robolectric 1.2 working.<br /><div><br /></div><div><br /></div><div><br /></div><br /><script src="https://gist.github.com/3165854.js?file=bbb.xml"></script><br /><br /><br /><br /><br />At this point, you should be able to open the pom.xml with intellij.<br /><br /><br />Now, to have robolectric working from intellij, you still need to make a couple of changes:<br />- the order of include of jars does not respect the one you specified. What's more, you will likely to get the STUB! error because android jar is included before junit and robolectric.<br />All you need to do is to move the android jar below junit and robolectric<br /><br />- you need to manually specify the javadocs for android. You do this by highlighting android jar, pressing the little edit in the lower left corner.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Cix5eHOX7ik/UA2uDjBWp2I/AAAAAAAAHso/ctXgbFyx8Tg/s1600/intellij1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://3.bp.blogspot.com/-Cix5eHOX7ik/UA2uDjBWp2I/AAAAAAAAHso/ctXgbFyx8Tg/s320/intellij1.png" width="320" /></a></div><br /><br /><br />and pressing the plus sign. Then you choose "Attach files or directories", point the path related to your android docs,<br />which is /docs/references under your ANDROID_HOME. Finally, you declare that it's related to javadoc.<br /><br /><br /><br /><br />Now you are _almost_ ready to start. You made all this mess because you want to have robolectric working with intellij.<br /><br />You need to create, right under src/ folder, the following path:<br /><i>src/test/java/ YOUR_PACKAGE&nbsp;</i><br /><i><br /></i><br />where you are going to include your unit tests, and you are done!<br /><br /><br />If you liked this post, please consider following me @fedepaol .<br /><br /><br /><br /><br /><div><br /></div><br /><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
I added here https://dl.dropbox.com/u/3092639/pom.xml a working pom.xml I am currently using. I just tried to mvn clean install from a clean checkout and it looks to be finding robolectric. I hope you are missing something which you can correct using this example. Ping me if you can&#39;t</div>
</div>
<div class='comment'>
<div class='author'>Christopher Perry</div>
<div class='content'>
I added the sonatype repository stuff, and it&#39;s not finding robolectric. Not sure why.</div>
</div>
<div class='comment'>
<div class='author'>Christopher Perry</div>
<div class='content'>
This comment has been removed by the author.</div>
</div>
</div>
